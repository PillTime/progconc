(n = q.size() nao e atomico, mas pode ser considerado como fosse neste caso porque
na thread3 nao acontece nada entre q.size() e a atribuiçao a n, e q.size() nao muda a queue)

q começa com 0 elementos
[thread1] q.add(3)[A] precede a.set(q.remove())[B]
[thread2] b.set(q.remove())[C]
[thread3] n = q.size()[D] precede q.add(n)[E], que precede q.add(n+1)[F]

A B D E C F { 3, 0 } q[0] = 1
A B D E F C { 3, 0 } q[0] = 1
A C D E B F { 0, 3 } q[0] = 1
A C D E F B { 0, 3 } q[0] = 1
A D B E C F { 3, 1 } q[0] = 2
A D B E F C { 3, 1 } q[0] = 2
A D C E B F { 1, 3 } q[0] = 2
A D C E F B { 1, 3 } q[0] = 2
A D E B C F { 3, 1 } q[0] = 2
A D E B F C { 3, 1 } q[0] = 2
A D E C B F { 1, 3 } q[0] = 2
A D E C F B { 1, 3 } q[0] = 2
A D E F B C { 3, 1 } q[0] = 2
A D E F C B { 1, 3 } q[0] = 2
D A B E C F { 3, 0 } q[0] = 1
D A B E F C { 3, 0 } q[0] = 1
D A C E B F { 0, 3 } q[0] = 1
D A C E F B { 0, 3 } q[0] = 1
D A E B C F { 3, 0 } q[0] = 1
D A E B F C { 3, 0 } q[0] = 1
D A E C B F { 0, 3 } q[0] = 1
D A E C F B { 0, 3 } q[0] = 1
D A E F B C { 3, 0 } q[0] = 1
D A E F C B { 0, 3 } q[0] = 1
D E A B C F { 0, 3 } q[0] = 1
D E A B F C { 0, 3 } q[0] = 1
D E A C B F { 3, 0 } q[0] = 1
D E A C F B { 3, 0 } q[0] = 1
D E A F B C { 0, 3 } q[0] = 1
D E A F C B { 3, 0 } q[0] = 1
D E C A B F { 3, 0 } q[0] = 1
D E C A F B { 3, 0 } q[0] = 1
D E C F A B { 1, 0 } q[0] = 3
D E F A B C { 0, 1 } q[0] = 3
D E F A C B { 1, 0 } q[0] = 3
D E F C A B { 1, 0 } q[0] = 3

----------

q começa com 1 elemento
[thread1] c.set(q.remove())[A]
[thread2] q.add(a.get())[B]
[thread3] n = q.size()[C] precede q.add(n)[D], que precede d.set(q.remove())[E]

1a3 A B C D E { 1, a3 }
1a0 A B C D E { 1, a0 }
1a3 A C B D E { 1, a3 }
1a0 A C B D E { 1, a0 }
1a3 A C D B E { 1, 0 }
1a0 A C D B E { 1, 0 }
1a3 A C D E B { 1, 0 }
1a0 A C D E B { 1, 0 }
1a3 B A C D E { 1, a3 }
1a0 B A C D E { 1, a0 }
1a3 B C A D E { 1, a3 }
1a0 B C A D E { 1, a0 }
1a3 B C D A E { 1, a3 }
1a0 B C D A E { 1, a0 }
1a3 B C D E A { a3, 1 }
1a0 B C D E A { a0, 1 }
1a3 C A B D E { 1, a3 }
1a0 C A B D E { 1, a0 }
1a3 C A D B E { 1, 1 }
1a0 C A D B E { 1, 1 }
1a3 C A D E B { 1, 1 }
1a0 C A D E B { 1, 1 }
1a3 C B A D E { 1, a3 }
1a0 C B A D E { 1, a0 }
1a3 C B D A E { 1, a3 }
1a0 C B D A E { 1, a0 }
1a3 C B D E A { a3, 1 }
1a0 C B D E A { a0, 1 }
1a3 C D A B E { 1, 1 }
1a0 C D A B E { 1, 1 }
1a3 C D A E B { 1, 1 }
1a0 C D A E B { 1, 1 }
1a3 C D B A E { 1, 1 }
1a0 C D B A E { 1, 1 }
1a3 C D B E A { 1, 1 }
1a0 C D B E A { 1, 1 }
1a3 C D E A B { 1, 1 }
1a0 C D E A B { 1, 1 }
1a3 C D E B A { 1, 1 }
1a0 C D E B A { 1, 1 }
2a3 A B C D E { 2, a3 }
2a1 A B C D E { 2, a1 }
...

possibilities: { 1, 3 } 1a3
               { 1, 0 } 1a0
               { 3, 1 } 1a3
               { 0, 1 } 1a0
               { 1, 1 } 1
               { 2, 3 } 2a3
               { 2, 1 } 2a1
               { 3, 2 } 2a3
               { 1, 2 } 2a1
               { 2, 1 } 2
               { 1, 2 } 2
               { 3, 1 } 3a1
               { 3, 0 } 3a0
               { 1, 3 } 3a1
               { 0, 3 } 3a0
               { 3, 1 } 3
               { 1, 3 } 3
